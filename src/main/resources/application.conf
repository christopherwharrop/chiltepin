# User tunable bqserver configuration
bqserver {

  # The batch system type
  type = moab-torque

  bqstat {
    # Number of seconds between batch system status updates
    update-interval = 15
  }

  bqsub {
    # Minimum number of threads for job submission service
    min-submit-threads = 1

    # Maximum number of threads for job submission service
    max-submit-threads = 6
  }
}

# User tunable chiltepin configuration
chiltepin {

  # Number of seconds between requests for current status 
  update-interval = 10

}  

############################################################################
#                                                                          #
# !!! DO NOT MODIFY BELOW THIS LINE UNLESS YOU KNOW WHAT YOU ARE DOING !!! #
#                                                                          #  
############################################################################


# Configuration for the bqserver front-end actor 
bqgateway {
  akka {

    log-dead-letters-during-shutdown = off

    actor {
      provider = "akka.remote.RemoteActorRefProvider"
    }
    remote {

      log-remote-lifecycle-events = off

      untrusted-mode = on
      trusted-selection-paths = ["/user/bqGateway"]
      enabled-transports = ["akka.remote.netty.ssl"]
      netty.ssl{
        port = 0
        enable-ssl = true
        include "security.conf"
      }

    }

  }

}

# Configureation for the bqserver back-end actor
bqworker {
  akka {

    log-dead-letters-during-shutdown = off

    actor {
      deployment {
        /bqSub {

          router = balancing-pool
           nr-of-instances = ${bqserver.bqsub.min-submit-threads}
           pool-dispatcher {
             executor = "thread-pool-executor"
             thread-pool-executor {
               core-pool-size-min = ${bqserver.bqsub.min-submit-threads}
               core-pool-size-max = ${bqserver.bqsub.max-submit-threads}
             }

           }



#          router = round-robin-pool
#          nr-of-instances = ${bqserver.bqsub.min-submit-threads}
#          pool-dispatcher {
#            type = akka.dispatch.BalancingDispatcherConfigurator
#            fork-join-executor.parallelism-min = ${bqserver.bqsub.min-submit-threads}
#            fork-join-executor.parallelism-max = ${bqserver.bqsub.max-submit-threads}
#          }
          resizer {
            enabled = on
            lower-bound = ${bqserver.bqsub.min-submit-threads}
            upper-bound = ${bqserver.bqsub.max-submit-threads}
            messages-per-resize = 5
          }
        }
      }   
    }
  }
}


workflow {
  akka {

    log-dead-letters-during-shutdown = off
  
    actor {
      provider = "akka.remote.RemoteActorRefProvider"
    }
    remote {
      log-remote-lifecycle-events = off

      untrusted-mode = on

      enabled-transports = ["akka.remote.netty.ssl"]
      netty.ssl{
        port = 0
        enable-ssl = true
        include "security.conf"
      }

    }
  }
}
